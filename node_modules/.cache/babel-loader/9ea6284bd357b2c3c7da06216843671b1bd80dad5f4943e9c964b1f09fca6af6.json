{"ast":null,"code":"function RetryOperation(timeouts, options) {\n  // Compatibility for the old (timeouts, retryForever) signature\n  if (typeof options === 'boolean') {\n    options = {\n      forever: options\n    };\n  }\n  this._originalTimeouts = JSON.parse(JSON.stringify(timeouts));\n  this._timeouts = timeouts;\n  this._options = options || {};\n  this._maxRetryTime = options && options.maxRetryTime || Infinity;\n  this._fn = null;\n  this._errors = [];\n  this._attempts = 1;\n  this._operationTimeout = null;\n  this._operationTimeoutCb = null;\n  this._timeout = null;\n  this._operationStart = null;\n  if (this._options.forever) {\n    this._cachedTimeouts = this._timeouts.slice(0);\n  }\n}\nmodule.exports = RetryOperation;\nRetryOperation.prototype.reset = function () {\n  this._attempts = 1;\n  this._timeouts = this._originalTimeouts;\n};\nRetryOperation.prototype.stop = function () {\n  if (this._timeout) {\n    clearTimeout(this._timeout);\n  }\n  this._timeouts = [];\n  this._cachedTimeouts = null;\n};\nRetryOperation.prototype.retry = function (err) {\n  if (this._timeout) {\n    clearTimeout(this._timeout);\n  }\n  if (!err) {\n    return false;\n  }\n  var currentTime = new Date().getTime();\n  if (err && currentTime - this._operationStart >= this._maxRetryTime) {\n    this._errors.unshift(new Error('RetryOperation timeout occurred'));\n    return false;\n  }\n  this._errors.push(err);\n  var timeout = this._timeouts.shift();\n  if (timeout === undefined) {\n    if (this._cachedTimeouts) {\n      // retry forever, only keep last error\n      this._errors.splice(this._errors.length - 1, this._errors.length);\n      this._timeouts = this._cachedTimeouts.slice(0);\n      timeout = this._timeouts.shift();\n    } else {\n      return false;\n    }\n  }\n  var self = this;\n  var timer = setTimeout(function () {\n    self._attempts++;\n    if (self._operationTimeoutCb) {\n      self._timeout = setTimeout(function () {\n        self._operationTimeoutCb(self._attempts);\n      }, self._operationTimeout);\n      if (self._options.unref) {\n        self._timeout.unref();\n      }\n    }\n    self._fn(self._attempts);\n  }, timeout);\n  if (this._options.unref) {\n    timer.unref();\n  }\n  return true;\n};\nRetryOperation.prototype.attempt = function (fn, timeoutOps) {\n  this._fn = fn;\n  if (timeoutOps) {\n    if (timeoutOps.timeout) {\n      this._operationTimeout = timeoutOps.timeout;\n    }\n    if (timeoutOps.cb) {\n      this._operationTimeoutCb = timeoutOps.cb;\n    }\n  }\n  var self = this;\n  if (this._operationTimeoutCb) {\n    this._timeout = setTimeout(function () {\n      self._operationTimeoutCb();\n    }, self._operationTimeout);\n  }\n  this._operationStart = new Date().getTime();\n  this._fn(this._attempts);\n};\nRetryOperation.prototype.try = function (fn) {\n  console.log('Using RetryOperation.try() is deprecated');\n  this.attempt(fn);\n};\nRetryOperation.prototype.start = function (fn) {\n  console.log('Using RetryOperation.start() is deprecated');\n  this.attempt(fn);\n};\nRetryOperation.prototype.start = RetryOperation.prototype.try;\nRetryOperation.prototype.errors = function () {\n  return this._errors;\n};\nRetryOperation.prototype.attempts = function () {\n  return this._attempts;\n};\nRetryOperation.prototype.mainError = function () {\n  if (this._errors.length === 0) {\n    return null;\n  }\n  var counts = {};\n  var mainError = null;\n  var mainErrorCount = 0;\n  for (var i = 0; i < this._errors.length; i++) {\n    var error = this._errors[i];\n    var message = error.message;\n    var count = (counts[message] || 0) + 1;\n    counts[message] = count;\n    if (count >= mainErrorCount) {\n      mainError = error;\n      mainErrorCount = count;\n    }\n  }\n  return mainError;\n};","map":{"version":3,"names":["RetryOperation","timeouts","options","forever","_originalTimeouts","JSON","parse","stringify","_timeouts","_options","_maxRetryTime","maxRetryTime","Infinity","_fn","_errors","_attempts","_operationTimeout","_operationTimeoutCb","_timeout","_operationStart","_cachedTimeouts","slice","module","exports","prototype","reset","stop","clearTimeout","retry","err","currentTime","Date","getTime","unshift","Error","push","timeout","shift","undefined","splice","length","self","timer","setTimeout","unref","attempt","fn","timeoutOps","cb","try","console","log","start","errors","attempts","mainError","counts","mainErrorCount","i","error","message","count"],"sources":["/Users/alexmihalascu/Desktop/mpdb-app/node_modules/promise-retry/node_modules/retry/lib/retry_operation.js"],"sourcesContent":["function RetryOperation(timeouts, options) {\n  // Compatibility for the old (timeouts, retryForever) signature\n  if (typeof options === 'boolean') {\n    options = { forever: options };\n  }\n\n  this._originalTimeouts = JSON.parse(JSON.stringify(timeouts));\n  this._timeouts = timeouts;\n  this._options = options || {};\n  this._maxRetryTime = options && options.maxRetryTime || Infinity;\n  this._fn = null;\n  this._errors = [];\n  this._attempts = 1;\n  this._operationTimeout = null;\n  this._operationTimeoutCb = null;\n  this._timeout = null;\n  this._operationStart = null;\n\n  if (this._options.forever) {\n    this._cachedTimeouts = this._timeouts.slice(0);\n  }\n}\nmodule.exports = RetryOperation;\n\nRetryOperation.prototype.reset = function() {\n  this._attempts = 1;\n  this._timeouts = this._originalTimeouts;\n}\n\nRetryOperation.prototype.stop = function() {\n  if (this._timeout) {\n    clearTimeout(this._timeout);\n  }\n\n  this._timeouts       = [];\n  this._cachedTimeouts = null;\n};\n\nRetryOperation.prototype.retry = function(err) {\n  if (this._timeout) {\n    clearTimeout(this._timeout);\n  }\n\n  if (!err) {\n    return false;\n  }\n  var currentTime = new Date().getTime();\n  if (err && currentTime - this._operationStart >= this._maxRetryTime) {\n    this._errors.unshift(new Error('RetryOperation timeout occurred'));\n    return false;\n  }\n\n  this._errors.push(err);\n\n  var timeout = this._timeouts.shift();\n  if (timeout === undefined) {\n    if (this._cachedTimeouts) {\n      // retry forever, only keep last error\n      this._errors.splice(this._errors.length - 1, this._errors.length);\n      this._timeouts = this._cachedTimeouts.slice(0);\n      timeout = this._timeouts.shift();\n    } else {\n      return false;\n    }\n  }\n\n  var self = this;\n  var timer = setTimeout(function() {\n    self._attempts++;\n\n    if (self._operationTimeoutCb) {\n      self._timeout = setTimeout(function() {\n        self._operationTimeoutCb(self._attempts);\n      }, self._operationTimeout);\n\n      if (self._options.unref) {\n          self._timeout.unref();\n      }\n    }\n\n    self._fn(self._attempts);\n  }, timeout);\n\n  if (this._options.unref) {\n      timer.unref();\n  }\n\n  return true;\n};\n\nRetryOperation.prototype.attempt = function(fn, timeoutOps) {\n  this._fn = fn;\n\n  if (timeoutOps) {\n    if (timeoutOps.timeout) {\n      this._operationTimeout = timeoutOps.timeout;\n    }\n    if (timeoutOps.cb) {\n      this._operationTimeoutCb = timeoutOps.cb;\n    }\n  }\n\n  var self = this;\n  if (this._operationTimeoutCb) {\n    this._timeout = setTimeout(function() {\n      self._operationTimeoutCb();\n    }, self._operationTimeout);\n  }\n\n  this._operationStart = new Date().getTime();\n\n  this._fn(this._attempts);\n};\n\nRetryOperation.prototype.try = function(fn) {\n  console.log('Using RetryOperation.try() is deprecated');\n  this.attempt(fn);\n};\n\nRetryOperation.prototype.start = function(fn) {\n  console.log('Using RetryOperation.start() is deprecated');\n  this.attempt(fn);\n};\n\nRetryOperation.prototype.start = RetryOperation.prototype.try;\n\nRetryOperation.prototype.errors = function() {\n  return this._errors;\n};\n\nRetryOperation.prototype.attempts = function() {\n  return this._attempts;\n};\n\nRetryOperation.prototype.mainError = function() {\n  if (this._errors.length === 0) {\n    return null;\n  }\n\n  var counts = {};\n  var mainError = null;\n  var mainErrorCount = 0;\n\n  for (var i = 0; i < this._errors.length; i++) {\n    var error = this._errors[i];\n    var message = error.message;\n    var count = (counts[message] || 0) + 1;\n\n    counts[message] = count;\n\n    if (count >= mainErrorCount) {\n      mainError = error;\n      mainErrorCount = count;\n    }\n  }\n\n  return mainError;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}